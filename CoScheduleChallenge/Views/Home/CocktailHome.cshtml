@{
    ViewBag.Title = "Home Page";
}

<div class="card mt-3 pt-2">
    <div class="card-header">
        <h5>Spice up your summer with refreshing cocktails from our directory.</h5>

        <form class="form-inline">
            <input id="searchWord" class="form-control mr-sm-2" type="search" placeholder="Search by Name" aria-label="Search">
            <button id="search" class="btn btn-outline-primary" type="button">
                <span id="searchSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 
                Search
            </button>
        </form>


    </div>
    <div class="card-body">
        <table id="cocktailResult" class="table table-striped">
            
        </table>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        let search = document.getElementById("search");

        var cocktailData = new Array();

        search.addEventListener("click", event => {
            event.preventDefault();
            $('#searchSpinner').show();

            var searchWord = $('#searchWord').val();

            var url = '@Url.Action("Find", "Home")';

            fetch('https://www.thecocktaildb.com/api/json/v1/1/search.php?s=' + searchWord)
                .then((response) => { return response.json(); })
                .then((data) => {
                    cocktailData = data.drinks;
                    var cocktailResultHtml = ' <tr class="table-info"><th> Name </th><th> @Html.DisplayName("Drink Type")</th>' +
                                            '<th> @Html.DisplayName("Glass Type") </th><th>@Html.DisplayName("Drink Category")</th><th></th><th></th></tr>';
                    data.drinks.forEach(drink => {   
                        cocktailResultHtml += '<tr id=\''+drink.idDrink+'\'>';
                        cocktailResultHtml += '<td>'+drink.strDrink+'</td>';
                        cocktailResultHtml += '<td>'+drink.strAlcoholic+'</td>';
                        cocktailResultHtml += '<td>'+drink.strGlass+'</td>';
                        cocktailResultHtml += '<td>'+drink.strCategory+'</td>';
                        cocktailResultHtml += '<td> <img src=\'' + drink.strDrinkThumb + '\' width=\'50\' height=\'50\' /></td>';
                        cocktailResultHtml += '<td> <input type="button" class="btn btn btn-outline-info btn-sm mr-2" value="Add" onclick="addToFavs(' + drink.idDrink + ')" /> </td>';
                        cocktailResultHtml += '</tr>';
                    });

                    $('#cocktailResult').append(cocktailResultHtml);
                    $('#searchSpinner').hide();
                });
            
        });

        function addToFavs(id) {

            var query = cocktailData.find(x => x.idDrink == id);

            $.ajax({
                type: 'POST',
                url: '@Url.Action("AddCocktail", "Home")',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(query),
                success: function (response) {
                    alert(response);
                },
                error: function (err) {
                    alert(err.responseText);
                }
            });
        }

        $(document).ready(function () {
            $(".active").removeClass("active");
            $("#link-home").addClass("active");
            $(".spinner-border").hide();
        });

    </script>
}